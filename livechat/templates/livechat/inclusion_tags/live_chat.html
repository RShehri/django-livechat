{% load jmbo_inclusion_tags jmbo_template_tags %}
{% load comments likes_inclusion_tags moderator_inclusion_tags %}
{% load livechat_tags mama_inclusion_tags %}

<div class="{{ live_chat.current_live_chat.primary_category.color}} ">
  <div class="h1">
    {{ live_chat.current_live_chat.title }}
    {% comment %}
    <div class="stamp">
        {% humanize_time_diff live_chat.current_live_chat.created "Ago" %} // <a href="#comments">{{ live_chat.current_live_chat.comment_count }} Comments</a> // {% likes live_chat.current_live_chat %}
    </div>
    {% endcomment %}
  </div>

  <div class="content-inner">
    <div class="post">
      {{ live_chat.current_live_chat.description|safe|linebreaks }}
    </div>

    <div class="h1">Questions and Responses</div>
    <div class="items">
        {% for comment in live_chat.current_live_chat.comment_set %}
            <div class="item comment no-pic">
                <div class="meta">
                    <div class="title">{{ comment.name }}</div>
                    <div class="stamp">{{ comment.submit_date }} | {% likes comment %} {% report_comment_abuse comment %}</a></div>
                    <div class="stamp">{{ comment.comment|linebreaks }}</div>
                </div>

                {% if comment.livechatresponse_set.exists %}
                <div class="item comment" style="padding-left: 15px">
                    {% for response in comment.livechatresponse_set.all %}
                        <div class="meta">
                            <div class="title">
                                Response by:
                                {{response.author.username}}
                            </div>
                            <div class="stamp">{{ response.updated_at }}</div>
                            <div class="stamp">{{response.response}}</div>
                        </div>
                    {% endfor %}
                </div>
                {% endif %}

            </div>
        {% empty %}
        <div class="post">
          No questions yet. Go ahead and ask a question.
        </div>
        {% endfor %}
    </div>

    {% if live_chat.can_render_comment_form %}
        {% render_comment_form for live_chat.current_live_chat %}
    {% else %}
        {% if live_chat.can_comment_code == 'auth_required' %}
        <div style="padding: 10px">
            <a href="{% url login %}?next={{ request.META.PATH_INFO }}">
                Sign in to comment or ask a question
            </a>
        </div>
        {% endif %}
    {% endif %}

  </div>
</div>

